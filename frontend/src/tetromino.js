import { palette } from "@/assets/js/palette.js";

const tetrominoes = {
  O: {
    name: "O",
    type: 1,
    color: palette.tetrominoColor[0],
    pieces: [
      [
        [0, 0],
        [1, 0],
        [0, -1],
        [1, -1],
      ],
      [
        [0, 0],
        [1, 0],
        [0, 1],
        [1, 1],
      ],
      [
        [0, 0],
        [-1, 0],
        [0, 1],
        [-1, 1],
      ],
      [
        [0, 0],
        [-1, 0],
        [0, -1],
        [-1, -1],
      ],
    ],
  },
  I: {
    name: "I",
    type: 2,
    color: palette.tetrominoColor[1],
    pieces: [
      [
        [0, 0],
        [-1, 0],
        [1, 0],
        [2, 0],
      ],
      [
        [0, 0],
        [0, -1],
        [0, 1],
        [0, 2],
      ],
      [
        [0, 0],
        [1, 0],
        [-1, 0],
        [-2, 0],
      ],
      [
        [0, 0],
        [0, 1],
        [0, -1],
        [0, -2],
      ],
    ],
  },
  T: {
    name: "T",
    type: 3,
    color: palette.tetrominoColor[2],
    pieces: [
      [
        [0, 0],
        [-1, 0],
        [1, 0],
        [0, -1],
      ],
      [
        [0, 0],
        [0, -1],
        [0, 1],
        [1, 0],
      ],
      [
        [0, 0],
        [-1, 0],
        [1, 0],
        [0, 1],
      ],
      [
        [0, 0],
        [-1, 0],
        [0, 1],
        [0, -1],
      ],
    ],
  },
  S: {
    name: "S",
    type: 4,
    color: palette.tetrominoColor[3],
    pieces: [
      [
        [0, 0],
        [-1, 0],
        [0, -1],
        [1, -1],
      ],
      [
        [0, 0],
        [1, 0],
        [0, -1],
        [1, 1],
      ],
      [
        [0, 0],
        [-1, 1],
        [1, 0],
        [0, 1],
      ],
      [
        [0, 0],
        [-1, 0],
        [-1, -1],
        [0, 1],
      ],
    ],
  },
  Z: {
    name: "Z",
    type: 5,
    color: palette.tetrominoColor[4],
    pieces: [
      [
        [0, 0],
        [-1, -1],
        [1, 0],
        [0, -1],
      ],
      [
        [0, 0],
        [1, 0],
        [0, 1],
        [1, -1],
      ],
      [
        [0, 0],
        [-1, 0],
        [1, 1],
        [0, 1],
      ],
      [
        [0, 0],
        [-1, 0],
        [0, -1],
        [-1, 1],
      ],
    ],
  },
  J: {
    name: "J",
    type: 6,
    color: palette.tetrominoColor[5],
    pieces: [
      [
        [0, 0],
        [-1, 0],
        [1, 0],
        [-1, -1],
      ],
      [
        [0, 0],
        [0, -1],
        [0, 1],
        [1, -1],
      ],
      [
        [0, 0],
        [-1, 0],
        [1, 0],
        [1, 1],
      ],
      [
        [0, 0],
        [-1, 1],
        [0, -1],
        [0, 1],
      ],
    ],
  },
  L: {
    name: "L",
    type: 7,
    color: palette.tetrominoColor[6],
    pieces: [
      [
        [0, 0],
        [-1, 0],
        [1, 0],
        [1, -1],
      ],
      [
        [0, 0],
        [1, 1],
        [0, -1],
        [0, 1],
      ],
      [
        [0, 0],
        [-1, 0],
        [1, 0],
        [-1, 1],
      ],
      [
        [0, 0],
        [-1, -1],
        [0, -1],
        [0, 1],
      ],
    ],
  },
};

export const rotationOffset = {
  A: [
    [
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
    ],
    [
      [0, 0],
      [1, 0],
      [1, 1],
      [0, -2],
      [1, -2],
    ],
    [
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
    ],
    [
      [0, 0],
      [-1, 0],
      [-1, 1],
      [0, -2],
      [-1, -2],
    ],
  ],
  I: [
    [
      [0, 0],
      [-1, 0],
      [2, 0],
      [-1, 0],
      [2, 0],
    ],
    [
      [-1, 0],
      [0, 0],
      [0, 0],
      [0, -1],
      [0, 2],
    ],
    [
      [-1, -1],
      [1, -1],
      [-2, -1],
      [1, 0],
      [-2, 0],
    ],
    [
      [0, -1],
      [0, -1],
      [0, -1],
      [0, 1],
      [0, -2],
    ],
  ],
  O: [
    [
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
    ],
    [
      [0, 1],
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
    ],
    [
      [-1, 1],
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
    ],
    [
      [-1, 0],
      [0, 0],
      [0, 0],
      [0, 0],
      [0, 0],
    ],
  ],
};

function shuffleBag() {
  const arr = ["I", "J", "L", "O", "S", "T", "Z"];

  for (let i = arr.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }

  return arr;
}

export function getBags() {
  const result = [];
  const bag = shuffleBag();

  for (let i = 0; i < bag.length; i++) {
    result.push(tetrominoes[bag[i]]);
  }

  return result;
}
